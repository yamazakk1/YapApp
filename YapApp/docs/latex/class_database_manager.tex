\doxysection{Database\+Manager Class Reference}
\hypertarget{class_database_manager}{}\label{class_database_manager}\index{DatabaseManager@{DatabaseManager}}


Менеджер работы с базой данных приложения  




{\ttfamily \#include $<$database.\+h$>$}

Inheritance diagram for Database\+Manager\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_database_manager}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{class_database_manager_a3cbc0c691ef2b9e7851a33959817dee6}{connect}} ()
\begin{DoxyCompactList}\small\item\em Подключается к базе данных \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{class_database_manager_aa4191649a436b20af9d2151e141ee148}{is\+Connected}} () const
\begin{DoxyCompactList}\small\item\em Проверяет активное подключение к БД \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{class_database_manager_a510a374b1af52a5884da5d5841f78906}{register\+User}} (const QString \&username, const QString \&password, const QString \&email="{}"{})
\begin{DoxyCompactList}\small\item\em Регистрирует нового пользователя \end{DoxyCompactList}\item 
QJson\+Object \mbox{\hyperlink{class_database_manager_a42d1f36765b1a6fedffbece2d0143009}{authenticate\+User}} (const QString \&username, const QString \&password)
\begin{DoxyCompactList}\small\item\em Аутентифицирует пользователя \end{DoxyCompactList}\item 
QJson\+Object \mbox{\hyperlink{class_database_manager_a7ec65dd93603e103657ca40f1cd69dc0}{get\+User\+By\+Id}} (int user\+Id)
\begin{DoxyCompactList}\small\item\em Получает данные пользователя по ID. \end{DoxyCompactList}\item 
QJson\+Object \mbox{\hyperlink{class_database_manager_a4aa110527206a1efbc51d1456cbe51ea}{get\+User\+By\+Username}} (const QString \&username)
\begin{DoxyCompactList}\small\item\em Получает данные пользователя по логину \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{class_database_manager_a4ec1070ffe5d42b7215db8f2ea335a51}{send\+Message}} (int sender\+Id, int receiver\+Id, const QString \&content)
\begin{DoxyCompactList}\small\item\em Отправляет сообщение \end{DoxyCompactList}\item 
QJson\+Array \mbox{\hyperlink{class_database_manager_a554a7487da54b3c5a4dad2af167a5f0e}{get\+User\+Messages}} (int user\+Id, int limit=50)
\begin{DoxyCompactList}\small\item\em Получает сообщения пользователя \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{class_database_manager_a38ab42b522a0f826c6c2fc9e22cb0b8b}{mark\+Message\+As\+Read}} (int message\+Id)
\begin{DoxyCompactList}\small\item\em Помечает сообщение как прочитанное \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_database_manager_aa3c02205a9ddce62e9f5b904375a2112}{init\+Database\+Schema}} ()
\begin{DoxyCompactList}\small\item\em Инициализирует структуру БД (таблицы) \end{DoxyCompactList}\item 
QJson\+Array \mbox{\hyperlink{class_database_manager_a24a0a309990142d639a6429e4a18eaf2}{get\+User\+Contacts}} (int user\+Id)
\begin{DoxyCompactList}\small\item\em Получает список контактов пользователя \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{class_database_manager_aaa65a69d209e20b4b8464418d610eb4f}{add\+Contact}} (int user\+Id, int contact\+Id)
\begin{DoxyCompactList}\small\item\em Добавляет контакт пользователю \end{DoxyCompactList}\item 
QJson\+Array \mbox{\hyperlink{class_database_manager_aedb854056fd7a83c58ab19b61c41195a}{get\+Chat\+Messages}} (int user1, int user2, int limit=100)
\begin{DoxyCompactList}\small\item\em Получает историю переписки между двумя пользователями \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{class_database_manager}{Database\+Manager}} \& \mbox{\hyperlink{class_database_manager_a4abb527066e28f3928ef45af856e134c}{instance}} ()
\begin{DoxyCompactList}\small\item\em Получает единственный экземпляр класса \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Менеджер работы с базой данных приложения 

Реализует singleton для управления всеми операциями с БД\+:
\begin{DoxyItemize}
\item Подключение/отключение от БД
\item Работа с пользователями (регистрация, аутентификация)
\item Управление контактами и сообщениями
\item Инициализация структуры БД
\end{DoxyItemize}

\begin{DoxyWarning}{Warning}
Все методы требуют предварительного подключения к БД (\doxylink{class_database_manager_a3cbc0c691ef2b9e7851a33959817dee6}{connect()}) 
\end{DoxyWarning}


\doxysubsection{Member Function Documentation}
\Hypertarget{class_database_manager_aaa65a69d209e20b4b8464418d610eb4f}\index{DatabaseManager@{DatabaseManager}!addContact@{addContact}}
\index{addContact@{addContact}!DatabaseManager@{DatabaseManager}}
\doxysubsubsection{\texorpdfstring{addContact()}{addContact()}}
{\footnotesize\ttfamily \label{class_database_manager_aaa65a69d209e20b4b8464418d610eb4f} 
bool Database\+Manager\+::add\+Contact (\begin{DoxyParamCaption}\item[{int}]{user\+Id}{, }\item[{int}]{contact\+Id}{}\end{DoxyParamCaption})}



Добавляет контакт пользователю 


\begin{DoxyParams}{Parameters}
{\em user\+Id} & ID пользователя \\
\hline
{\em contact\+Id} & ID добавляемого контакта \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true при успешном добавлении 
\end{DoxyReturn}
\Hypertarget{class_database_manager_a42d1f36765b1a6fedffbece2d0143009}\index{DatabaseManager@{DatabaseManager}!authenticateUser@{authenticateUser}}
\index{authenticateUser@{authenticateUser}!DatabaseManager@{DatabaseManager}}
\doxysubsubsection{\texorpdfstring{authenticateUser()}{authenticateUser()}}
{\footnotesize\ttfamily \label{class_database_manager_a42d1f36765b1a6fedffbece2d0143009} 
QJson\+Object Database\+Manager\+::authenticate\+User (\begin{DoxyParamCaption}\item[{const QString \&}]{username}{, }\item[{const QString \&}]{password}{}\end{DoxyParamCaption})}



Аутентифицирует пользователя 


\begin{DoxyParams}{Parameters}
{\em username} & Логин пользователя \\
\hline
{\em password} & Пароль \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
QJson\+Object с данными пользователя или пустой объект при ошибке
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{auto}\ authData\ =\ dbManager.authenticateUser(\textcolor{stringliteral}{"{}user1"{}},\ \textcolor{stringliteral}{"{}pass123"{}});}
\DoxyCodeLine{\textcolor{keywordflow}{if}\ (authData.isEmpty())\ \{}
\DoxyCodeLine{\ \ \ \ qWarning()\ <<\ \textcolor{stringliteral}{"{}Authentication\ failed"{}};}
\DoxyCodeLine{\}}

\end{DoxyCode}
 \Hypertarget{class_database_manager_a3cbc0c691ef2b9e7851a33959817dee6}\index{DatabaseManager@{DatabaseManager}!connect@{connect}}
\index{connect@{connect}!DatabaseManager@{DatabaseManager}}
\doxysubsubsection{\texorpdfstring{connect()}{connect()}}
{\footnotesize\ttfamily \label{class_database_manager_a3cbc0c691ef2b9e7851a33959817dee6} 
bool Database\+Manager\+::connect (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Подключается к базе данных 

\begin{DoxyReturn}{Returns}
true при успешном подключении
\end{DoxyReturn}

\begin{DoxyExceptions}{Exceptions}
{\em std\+::runtime\+\_\+error} & при критических ошибках подключения \\
\hline
\end{DoxyExceptions}
\Hypertarget{class_database_manager_aedb854056fd7a83c58ab19b61c41195a}\index{DatabaseManager@{DatabaseManager}!getChatMessages@{getChatMessages}}
\index{getChatMessages@{getChatMessages}!DatabaseManager@{DatabaseManager}}
\doxysubsubsection{\texorpdfstring{getChatMessages()}{getChatMessages()}}
{\footnotesize\ttfamily \label{class_database_manager_aedb854056fd7a83c58ab19b61c41195a} 
QJson\+Array Database\+Manager\+::get\+Chat\+Messages (\begin{DoxyParamCaption}\item[{int}]{user1}{, }\item[{int}]{user2}{, }\item[{int}]{limit}{ = {\ttfamily 100}}\end{DoxyParamCaption})}



Получает историю переписки между двумя пользователями 


\begin{DoxyParams}{Parameters}
{\em user1} & ID первого пользователя \\
\hline
{\em user2} & ID второго пользователя \\
\hline
{\em limit} & Максимальное количество сообщений (по умолчанию 100) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
QJson\+Array с сообщениями 
\end{DoxyReturn}
\Hypertarget{class_database_manager_a7ec65dd93603e103657ca40f1cd69dc0}\index{DatabaseManager@{DatabaseManager}!getUserById@{getUserById}}
\index{getUserById@{getUserById}!DatabaseManager@{DatabaseManager}}
\doxysubsubsection{\texorpdfstring{getUserById()}{getUserById()}}
{\footnotesize\ttfamily \label{class_database_manager_a7ec65dd93603e103657ca40f1cd69dc0} 
QJson\+Object Database\+Manager\+::get\+User\+By\+Id (\begin{DoxyParamCaption}\item[{int}]{user\+Id}{}\end{DoxyParamCaption})}



Получает данные пользователя по ID. 


\begin{DoxyParams}{Parameters}
{\em user\+Id} & Идентификатор пользователя \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
QJson\+Object с данными пользователя 
\end{DoxyReturn}
\Hypertarget{class_database_manager_a4aa110527206a1efbc51d1456cbe51ea}\index{DatabaseManager@{DatabaseManager}!getUserByUsername@{getUserByUsername}}
\index{getUserByUsername@{getUserByUsername}!DatabaseManager@{DatabaseManager}}
\doxysubsubsection{\texorpdfstring{getUserByUsername()}{getUserByUsername()}}
{\footnotesize\ttfamily \label{class_database_manager_a4aa110527206a1efbc51d1456cbe51ea} 
QJson\+Object Database\+Manager\+::get\+User\+By\+Username (\begin{DoxyParamCaption}\item[{const QString \&}]{username}{}\end{DoxyParamCaption})}



Получает данные пользователя по логину 


\begin{DoxyParams}{Parameters}
{\em username} & Логин пользователя \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
QJson\+Object с данными пользователя 
\end{DoxyReturn}
\Hypertarget{class_database_manager_a24a0a309990142d639a6429e4a18eaf2}\index{DatabaseManager@{DatabaseManager}!getUserContacts@{getUserContacts}}
\index{getUserContacts@{getUserContacts}!DatabaseManager@{DatabaseManager}}
\doxysubsubsection{\texorpdfstring{getUserContacts()}{getUserContacts()}}
{\footnotesize\ttfamily \label{class_database_manager_a24a0a309990142d639a6429e4a18eaf2} 
QJson\+Array Database\+Manager\+::get\+User\+Contacts (\begin{DoxyParamCaption}\item[{int}]{user\+Id}{}\end{DoxyParamCaption})}



Получает список контактов пользователя 


\begin{DoxyParams}{Parameters}
{\em user\+Id} & ID пользователя \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
QJson\+Array с контактами 
\end{DoxyReturn}
\Hypertarget{class_database_manager_a554a7487da54b3c5a4dad2af167a5f0e}\index{DatabaseManager@{DatabaseManager}!getUserMessages@{getUserMessages}}
\index{getUserMessages@{getUserMessages}!DatabaseManager@{DatabaseManager}}
\doxysubsubsection{\texorpdfstring{getUserMessages()}{getUserMessages()}}
{\footnotesize\ttfamily \label{class_database_manager_a554a7487da54b3c5a4dad2af167a5f0e} 
QJson\+Array Database\+Manager\+::get\+User\+Messages (\begin{DoxyParamCaption}\item[{int}]{user\+Id}{, }\item[{int}]{limit}{ = {\ttfamily 50}}\end{DoxyParamCaption})}



Получает сообщения пользователя 


\begin{DoxyParams}{Parameters}
{\em user\+Id} & ID пользователя \\
\hline
{\em limit} & Максимальное количество сообщений (по умолчанию 50) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
QJson\+Array с сообщениями 
\end{DoxyReturn}
\Hypertarget{class_database_manager_aa3c02205a9ddce62e9f5b904375a2112}\index{DatabaseManager@{DatabaseManager}!initDatabaseSchema@{initDatabaseSchema}}
\index{initDatabaseSchema@{initDatabaseSchema}!DatabaseManager@{DatabaseManager}}
\doxysubsubsection{\texorpdfstring{initDatabaseSchema()}{initDatabaseSchema()}}
{\footnotesize\ttfamily \label{class_database_manager_aa3c02205a9ddce62e9f5b904375a2112} 
void Database\+Manager\+::init\+Database\+Schema (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Инициализирует структуру БД (таблицы) 

\begin{DoxyWarning}{Warning}
Удаляет существующие данные при повторном вызове! 
\end{DoxyWarning}
\Hypertarget{class_database_manager_a4abb527066e28f3928ef45af856e134c}\index{DatabaseManager@{DatabaseManager}!instance@{instance}}
\index{instance@{instance}!DatabaseManager@{DatabaseManager}}
\doxysubsubsection{\texorpdfstring{instance()}{instance()}}
{\footnotesize\ttfamily \label{class_database_manager_a4abb527066e28f3928ef45af856e134c} 
\mbox{\hyperlink{class_database_manager}{Database\+Manager}} \& Database\+Manager\+::instance (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Получает единственный экземпляр класса 

\begin{DoxyReturn}{Returns}
Ссылка на экземпляр \doxylink{class_database_manager}{Database\+Manager} 
\end{DoxyReturn}
\Hypertarget{class_database_manager_aa4191649a436b20af9d2151e141ee148}\index{DatabaseManager@{DatabaseManager}!isConnected@{isConnected}}
\index{isConnected@{isConnected}!DatabaseManager@{DatabaseManager}}
\doxysubsubsection{\texorpdfstring{isConnected()}{isConnected()}}
{\footnotesize\ttfamily \label{class_database_manager_aa4191649a436b20af9d2151e141ee148} 
bool Database\+Manager\+::is\+Connected (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption}) const}



Проверяет активное подключение к БД 

\begin{DoxyReturn}{Returns}
true если подключение установлено и валидно 
\end{DoxyReturn}
\Hypertarget{class_database_manager_a38ab42b522a0f826c6c2fc9e22cb0b8b}\index{DatabaseManager@{DatabaseManager}!markMessageAsRead@{markMessageAsRead}}
\index{markMessageAsRead@{markMessageAsRead}!DatabaseManager@{DatabaseManager}}
\doxysubsubsection{\texorpdfstring{markMessageAsRead()}{markMessageAsRead()}}
{\footnotesize\ttfamily \label{class_database_manager_a38ab42b522a0f826c6c2fc9e22cb0b8b} 
bool Database\+Manager\+::mark\+Message\+As\+Read (\begin{DoxyParamCaption}\item[{int}]{message\+Id}{}\end{DoxyParamCaption})}



Помечает сообщение как прочитанное 


\begin{DoxyParams}{Parameters}
{\em message\+Id} & ID сообщения \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true при успешном обновлении 
\end{DoxyReturn}
\Hypertarget{class_database_manager_a510a374b1af52a5884da5d5841f78906}\index{DatabaseManager@{DatabaseManager}!registerUser@{registerUser}}
\index{registerUser@{registerUser}!DatabaseManager@{DatabaseManager}}
\doxysubsubsection{\texorpdfstring{registerUser()}{registerUser()}}
{\footnotesize\ttfamily \label{class_database_manager_a510a374b1af52a5884da5d5841f78906} 
bool Database\+Manager\+::register\+User (\begin{DoxyParamCaption}\item[{const QString \&}]{username}{, }\item[{const QString \&}]{password}{, }\item[{const QString \&}]{email}{ = {\ttfamily "{}"{}}}\end{DoxyParamCaption})}



Регистрирует нового пользователя 


\begin{DoxyParams}{Parameters}
{\em username} & Логин пользователя \\
\hline
{\em password} & Пароль (будет захеширован) \\
\hline
{\em email} & Email пользователя (опционально) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true при успешной регистрации
\end{DoxyReturn}
\begin{DoxyNote}{Note}
Пароль хранится в виде хеша (sha256) 
\end{DoxyNote}
\Hypertarget{class_database_manager_a4ec1070ffe5d42b7215db8f2ea335a51}\index{DatabaseManager@{DatabaseManager}!sendMessage@{sendMessage}}
\index{sendMessage@{sendMessage}!DatabaseManager@{DatabaseManager}}
\doxysubsubsection{\texorpdfstring{sendMessage()}{sendMessage()}}
{\footnotesize\ttfamily \label{class_database_manager_a4ec1070ffe5d42b7215db8f2ea335a51} 
bool Database\+Manager\+::send\+Message (\begin{DoxyParamCaption}\item[{int}]{sender\+Id}{, }\item[{int}]{receiver\+Id}{, }\item[{const QString \&}]{content}{}\end{DoxyParamCaption})}



Отправляет сообщение 


\begin{DoxyParams}{Parameters}
{\em sender\+Id} & ID отправителя \\
\hline
{\em receiver\+Id} & ID получателя \\
\hline
{\em content} & Текст сообщения \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true при успешной отправке 
\end{DoxyReturn}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
database.\+h\item 
database.\+cpp\end{DoxyCompactItemize}
